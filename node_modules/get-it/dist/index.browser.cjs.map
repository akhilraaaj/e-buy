{"version":3,"file":"index.browser.cjs","sources":["../src/util/middlewareReducer.ts","../src/util/pubsub.ts","../src/createRequester.ts","../src/request/browser/fetchXhr.ts","../src/request/browser-request.ts","../src/index.browser.ts"],"sourcesContent":["export default (middleware: any) => {\n  const applyMiddleware = (hook: any, defaultValue: any, ...args: any[]) => {\n    const bailEarly = hook === 'onError'\n\n    let value = defaultValue\n    for (let i = 0; i < middleware[hook].length; i++) {\n      const handler = middleware[hook][i]\n      value = handler(value, ...args)\n\n      if (bailEarly && !value) {\n        break\n      }\n    }\n\n    return value\n  }\n\n  return applyMiddleware\n}\n","// Code borrowed from https://github.com/bjoerge/nano-pubsub\n\nexport interface Subscriber<Event> {\n  (event: Event): void\n}\nexport interface PubSub<Message> {\n  publish: (message: Message) => void\n  subscribe: (subscriber: Subscriber<Message>) => () => void\n}\n\nexport default function createPubSub<Message = void>(): PubSub<Message> {\n  const subscribers: {[id: string]: Subscriber<Message>} = Object.create(null)\n  let nextId = 0\n  function subscribe(subscriber: Subscriber<Message>) {\n    const id = nextId++\n    subscribers[id] = subscriber\n    return function unsubscribe() {\n      delete subscribers[id]\n    }\n  }\n\n  function publish(event: Message) {\n    for (const id in subscribers) {\n      subscribers[id](event)\n    }\n  }\n\n  return {\n    publish,\n    subscribe,\n  }\n}\n","import {processOptions} from './middleware/defaultOptionsProcessor'\nimport {validateOptions} from './middleware/defaultOptionsValidator'\nimport type {HttpRequest, Middleware, Middlewares, Requester} from './types'\nimport middlewareReducer from './util/middlewareReducer'\nimport pubsub from './util/pubsub'\n\nconst channelNames = ['request', 'response', 'progress', 'error', 'abort']\nconst middlehooks = [\n  'processOptions',\n  'validateOptions',\n  'interceptRequest',\n  'finalizeOptions',\n  'onRequest',\n  'onResponse',\n  'onError',\n  'onReturn',\n  'onHeaders',\n]\n\n/** @public */\nexport function createRequester(initMiddleware: Middlewares, httpRequest: HttpRequest): Requester {\n  const loadedMiddleware: any[] = []\n  const middleware = middlehooks.reduce(\n    (ware: any, name: any) => {\n      ware[name] = ware[name] || []\n      return ware\n    },\n    {\n      processOptions: [processOptions],\n      validateOptions: [validateOptions],\n    }\n  )\n\n  function request(opts: any) {\n    const channels = channelNames.reduce((target: any, name: any): any => {\n      target[name] = pubsub()\n      return target\n    }, {})\n\n    // Prepare a middleware reducer that can be reused throughout the lifecycle\n    const applyMiddleware = middlewareReducer(middleware)\n\n    // Parse the passed options\n    const options = applyMiddleware('processOptions', opts)\n\n    // Validate the options\n    applyMiddleware('validateOptions', options)\n\n    // Build a context object we can pass to child handlers\n    const context = {options, channels, applyMiddleware}\n\n    // We need to hold a reference to the current, ongoing request,\n    // in order to allow cancellation. In the case of the retry middleware,\n    // a new request might be triggered\n    let ongoingRequest: any = null\n    const unsubscribe = channels.request.subscribe((ctx: any) => {\n      // Let request adapters (node/browser) perform the actual request\n      ongoingRequest = httpRequest(ctx, (err: any, res: any) => onResponse(err, res, ctx))\n    })\n\n    // If we abort the request, prevent further requests from happening,\n    // and be sure to cancel any ongoing request (obviously)\n    channels.abort.subscribe(() => {\n      unsubscribe()\n      if (ongoingRequest) {\n        ongoingRequest.abort()\n      }\n    })\n\n    // See if any middleware wants to modify the return value - for instance\n    // the promise or observable middlewares\n    const returnValue = applyMiddleware('onReturn', channels, context)\n\n    // If return value has been modified by a middleware, we expect the middleware\n    // to publish on the 'request' channel. If it hasn't been modified, we want to\n    // trigger it right away\n    if (returnValue === channels) {\n      channels.request.publish(context)\n    }\n\n    return returnValue\n\n    function onResponse(reqErr: any, res: any, ctx: any) {\n      let error = reqErr\n      let response = res\n\n      // We're processing non-errors first, in case a middleware converts the\n      // response into an error (for instance, status >= 400 == HttpError)\n      if (!error) {\n        try {\n          response = applyMiddleware('onResponse', res, ctx)\n        } catch (err) {\n          response = null\n          error = err\n        }\n      }\n\n      // Apply error middleware - if middleware return the same (or a different) error,\n      // publish as an error event. If we *don't* return an error, assume it has been handled\n      error = error && applyMiddleware('onError', error, ctx)\n\n      // Figure out if we should publish on error/response channels\n      if (error) {\n        channels.error.publish(error)\n      } else if (response) {\n        channels.response.publish(response)\n      }\n    }\n  }\n\n  request.use = function use(newMiddleware: Middleware) {\n    if (!newMiddleware) {\n      throw new Error('Tried to add middleware that resolved to falsey value')\n    }\n\n    if (typeof newMiddleware === 'function') {\n      throw new Error(\n        'Tried to add middleware that was a function. It probably expects you to pass options to it.'\n      )\n    }\n\n    if (newMiddleware.onReturn && middleware.onReturn.length > 0) {\n      throw new Error(\n        'Tried to add new middleware with `onReturn` handler, but another handler has already been registered for this event'\n      )\n    }\n\n    middlehooks.forEach((key) => {\n      if (newMiddleware[key]) {\n        middleware[key].push(newMiddleware[key])\n      }\n    })\n\n    loadedMiddleware.push(newMiddleware)\n    return request\n  }\n\n  request.clone = function clone() {\n    return createRequester(loadedMiddleware, httpRequest)\n  }\n\n  initMiddleware.forEach(request.use)\n\n  return request\n}\n","/**\n * Mimicks the XMLHttpRequest API with only the parts needed for get-it's XHR adapter\n */\nexport class FetchXhr\n  implements Pick<XMLHttpRequest, 'open' | 'abort' | 'getAllResponseHeaders' | 'setRequestHeader'>\n{\n  /**\n   * Public interface, interop with real XMLHttpRequest\n   */\n  onabort: () => void\n  onerror: (error?: any) => void\n  onreadystatechange: () => void\n  ontimeout: XMLHttpRequest['ontimeout']\n  /**\n   * https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState\n   */\n  readyState: 0 | 1 | 2 | 3 | 4 = 0\n  response: XMLHttpRequest['response']\n  responseText: XMLHttpRequest['responseText']\n  responseType: XMLHttpRequest['responseType']\n  status: XMLHttpRequest['status']\n  statusText: XMLHttpRequest['statusText']\n  withCredentials: XMLHttpRequest['withCredentials']\n\n  /**\n   * Private implementation details\n   */\n  #method: string\n  #url: string\n  #resHeaders: string\n  #headers: Record<string, string> = {}\n  #controller?: AbortController\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars -- _async is only declared for typings compatibility\n  open(method: string, url: string, _async?: boolean) {\n    this.#method = method\n    this.#url = url\n    this.#resHeaders = ''\n    this.readyState = 1 // Open\n    this.onreadystatechange()\n    this.#controller = undefined\n  }\n  abort() {\n    if (this.#controller) {\n      this.#controller.abort()\n    }\n  }\n  getAllResponseHeaders() {\n    return this.#resHeaders\n  }\n  setRequestHeader(name: string, value: string) {\n    this.#headers[name] = value\n  }\n  send(body: BodyInit) {\n    const textBody = this.responseType !== 'arraybuffer'\n    const options: RequestInit = {\n      method: this.#method,\n      headers: this.#headers,\n      signal: null,\n      body,\n    }\n    if (typeof AbortController === 'function') {\n      this.#controller = new AbortController()\n      options.signal = this.#controller.signal\n    }\n\n    // Some environments (like CloudFlare workers) don't support credentials in\n    // RequestInitDict, and there doesn't seem to be any easy way to check for it,\n    // so for now let's just make do with a document check :/\n    if (typeof document !== 'undefined') {\n      options.credentials = this.withCredentials ? 'include' : 'omit'\n    }\n\n    fetch(this.#url, options)\n      .then((res): Promise<string | ArrayBuffer> => {\n        res.headers.forEach((value: any, key: any) => {\n          this.#resHeaders += `${key}: ${value}\\r\\n`\n        })\n        this.status = res.status\n        this.statusText = res.statusText\n        this.readyState = 3 // Loading\n        return textBody ? res.text() : res.arrayBuffer()\n      })\n      .then((resBody) => {\n        if (typeof resBody === 'string') {\n          this.responseText = resBody\n        } else {\n          this.response = resBody\n        }\n        this.readyState = 4 // Done\n        this.onreadystatechange()\n      })\n      .catch((err: Error) => {\n        if (err.name === 'AbortError') {\n          this.onabort()\n          return\n        }\n\n        this.onerror?.(err)\n      })\n  }\n}\n","import parseHeaders from 'parse-headers'\n\nimport {FetchXhr} from './browser/fetchXhr'\n\n// Use fetch if it's available, non-browser environments such as Deno, Edge Runtime and more provide fetch as a global but doesn't provide xhr\nconst adapter = typeof XMLHttpRequest === 'function' ? 'xhr' : 'fetch'\n\n// Fallback to fetch-based XHR polyfill for non-browser environments like Workers\nconst XmlHttpRequest = adapter === 'xhr' ? XMLHttpRequest : FetchXhr\n\nexport default (context: any, callback: any) => {\n  const opts = context.options\n  const options = context.applyMiddleware('finalizeOptions', opts)\n  const timers: any = {}\n\n  // Allow middleware to inject a response, for instance in the case of caching or mocking\n  const injectedResponse = context.applyMiddleware('interceptRequest', undefined, {\n    adapter,\n    context,\n  })\n\n  // If middleware injected a response, treat it as we normally would and return it\n  // Do note that the injected response has to be reduced to a cross-environment friendly response\n  if (injectedResponse) {\n    const cbTimer = setTimeout(callback, 0, null, injectedResponse)\n    const cancel = () => clearTimeout(cbTimer)\n    return {abort: cancel}\n  }\n\n  // We'll want to null out the request on success/failure\n  let xhr = new XmlHttpRequest()\n\n  const headers = options.headers\n  const delays = options.timeout\n\n  // Request state\n  let aborted = false\n  let loaded = false\n  let timedOut = false\n\n  // Apply event handlers\n  xhr.onerror = onError\n  xhr.ontimeout = onError\n  xhr.onabort = () => {\n    stopTimers(true)\n    aborted = true\n  }\n\n  xhr.onreadystatechange = () => {\n    // Prevent request from timing out\n    resetTimers()\n\n    if (aborted || xhr.readyState !== 4) {\n      return\n    }\n\n    // Will be handled by onError\n    if (xhr.status === 0) {\n      return\n    }\n\n    onLoad()\n  }\n\n  // @todo two last options to open() is username/password\n  xhr.open(\n    options.method,\n    options.url,\n    true // Always async\n  )\n\n  // Some options need to be applied after open\n  xhr.withCredentials = !!options.withCredentials\n\n  // Set headers\n  if (headers && xhr.setRequestHeader) {\n    for (const key in headers) {\n      // eslint-disable-next-line no-prototype-builtins\n      if (headers.hasOwnProperty(key)) {\n        xhr.setRequestHeader(key, headers[key])\n      }\n    }\n  }\n\n  if (options.rawBody) {\n    xhr.responseType = 'arraybuffer'\n  }\n\n  // Let middleware know we're about to do a request\n  context.applyMiddleware('onRequest', {options, adapter, request: xhr, context})\n\n  xhr.send(options.body || null)\n\n  // Figure out which timeouts to use (if any)\n  if (delays) {\n    timers.connect = setTimeout(() => timeoutRequest('ETIMEDOUT'), delays.connect)\n  }\n\n  return {abort}\n\n  function abort() {\n    aborted = true\n\n    if (xhr) {\n      xhr.abort()\n    }\n  }\n\n  function timeoutRequest(code: any) {\n    timedOut = true\n    xhr.abort()\n    const error: any = new Error(\n      code === 'ESOCKETTIMEDOUT'\n        ? `Socket timed out on request to ${options.url}`\n        : `Connection timed out on request to ${options.url}`\n    )\n    error.code = code\n    context.channels.error.publish(error)\n  }\n\n  function resetTimers() {\n    if (!delays) {\n      return\n    }\n\n    stopTimers()\n    timers.socket = setTimeout(() => timeoutRequest('ESOCKETTIMEDOUT'), delays.socket)\n  }\n\n  function stopTimers(force?: boolean) {\n    // Only clear the connect timeout if we've got a connection\n    if (force || aborted || (xhr.readyState >= 2 && timers.connect)) {\n      clearTimeout(timers.connect)\n    }\n\n    if (timers.socket) {\n      clearTimeout(timers.socket)\n    }\n  }\n\n  function onError(error?: any) {\n    if (loaded) {\n      return\n    }\n\n    // Clean up\n    stopTimers(true)\n    loaded = true\n    ;(xhr as any) = null\n\n    // Annoyingly, details are extremely scarce and hidden from us.\n    // We only really know that it is a network error\n    const err = error || new Error(`Network error while attempting to reach ${options.url}`)\n    err.isNetworkError = true\n    err.request = options\n    callback(err)\n  }\n\n  function reduceResponse() {\n    return {\n      body: xhr.response || xhr.responseText,\n      url: options.url,\n      method: options.method,\n      headers: parseHeaders(xhr.getAllResponseHeaders()),\n      statusCode: xhr.status,\n      statusMessage: xhr.statusText,\n    }\n  }\n\n  function onLoad() {\n    if (aborted || loaded || timedOut) {\n      return\n    }\n\n    if (xhr.status === 0) {\n      onError(new Error('Unknown XHR error'))\n      return\n    }\n\n    // Prevent being called twice\n    stopTimers()\n    loaded = true\n    callback(null, reduceResponse())\n  }\n}\n","import {createRequester} from './createRequester'\nimport httpRequester from './request/browser-request'\nimport type {HttpRequest, Middlewares, Requester} from './types'\n\nexport * from './types'\n\n/** @public */\nexport const getIt = (\n  initMiddleware: Middlewares = [],\n  httpRequest: HttpRequest = httpRequester\n): Requester => createRequester(initMiddleware, httpRequest)\n"],"names":["middlewareReducer","middleware","applyMiddleware","hook","defaultValue","bailEarly","value","args","i","length","handler","createPubSub","subscribers","Object","create","nextId","subscribe","subscriber","id","unsubscribe","publish","event","channelNames","middlehooks","createRequester","initMiddleware","httpRequest","loadedMiddleware","reduce","ware","name","processOptions","validateOptions","request","opts","channels","target","pubsub","options","context","ongoingRequest","ctx","err","res","onResponse","abort","returnValue","reqErr","error","response","use","newMiddleware","Error","onReturn","forEach","key","push","clone","_method","_url","_resHeaders","_headers","_controller","FetchXhr","constructor","readyState","__privateAdd","open","method","url","_async","__privateSet","onreadystatechange","__privateGet","getAllResponseHeaders","setRequestHeader","send","body","textBody","responseType","headers","signal","AbortController","document","credentials","withCredentials","fetch","then","status","statusText","text","arrayBuffer","resBody","responseText","catch","_a","onabort","onerror","call","WeakMap","adapter","XMLHttpRequest","XmlHttpRequest","httpRequester","callback","timers","injectedResponse","cbTimer","setTimeout","cancel","clearTimeout","xhr","delays","timeout","aborted","loaded","timedOut","onError","ontimeout","stopTimers","resetTimers","onLoad","hasOwnProperty","rawBody","connect","timeoutRequest","code","socket","force","isNetworkError","reduceResponse","parseHeaders","default","statusCode","statusMessage","getIt"],"mappings":"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"}